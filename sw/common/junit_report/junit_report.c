/*
-------------------------------------------------------------------------------
TYMPHANY





                  Timer service
                  -------------------------

                  SW Module Document




@file        Timer.c
@brief       This file implements the timer service which gives a "one-shot" callback 
             event after a specific time interval ie a Timer
@author      Bob.Xu 
@date        2015-10-15
@Copyright (c) <2015> Tymphany HK Ltd. All rights reserved.

DESCRIPTION: Generated by newclass.py
SCO/ERROR  : 
-------------------------------------------------------------------------------
*/
#include "commonTypes.h"
#include <stdio.h>

#include "junit_report.h"

#define JUNIT_HEADER_CLOSER_SIZE    (200)
#define JUNIT_TEST_CASE_REPORT_SIZE (200)
#define JUNIT_TEST_CASES_MAX_COUNT  (5)

char report[JUNIT_TEST_CASE_REPORT_SIZE * JUNIT_TEST_CASES_MAX_COUNT] = {0};
char report_temp_pass_fail[JUNIT_TEST_CASES_MAX_COUNT][JUNIT_TEST_CASE_REPORT_SIZE] = {0};
char closer[] = "  </testsuite>\r\n</testsuites>\r\n";

char header[] = "\n";

static char testsCasesAllCount = 0;
static char testsCasesFailCount = 0;

void addPassTestCase(testCasePassReport * testCase)
{
    sprintf(report_temp_pass_fail[testsCasesAllCount++],"    <testcase name=\"%s\"> </testcase> \r\n",
        testCase->testCaseName);
}

void addFailTestCase(testCaseFailReport * testCase)
{
    ++testsCasesFailCount;
    sprintf(report_temp_pass_fail[testsCasesAllCount++],"    <testcase name=\"%s\"><failure message=\"%s\"> </failure> </testcase>\r\n",
        testCase->testCaseName, testCase->failMessage);
}

void InitJunitXmlReport()
{
    uint8 ii;

    testsCasesAllCount = 0;
    testsCasesFailCount = 0;

    memset(report, 0x00, sizeof(report));

    for (ii = 0; ii < JUNIT_TEST_CASES_MAX_COUNT; ii++)
    {
        memset(report_temp_pass_fail, 0x00, sizeof(report_temp_pass_fail));
    }
}

void InittestCasePass(testCasePassReport * testCase)
{
    memset(testCase->testCaseName, 0x00, sizeof(testCase->testCaseName));
    strcpy (testCase->testCaseName,"test case name default");
}

void InittestCaseFail(testCaseFailReport * testCase)
{
    memset(testCase->testCaseName, 0x00, sizeof(testCase->testCaseName));
    strcpy (testCase->testCaseName,"test case name default");

    memset(testCase->failMessage, 0x00, sizeof(testCase->failMessage));
    strcpy (testCase->failMessage,"fail message default");
}

char* makeJunitXmlReport(char *testName)
{
    uint8 ii;

    sprintf(report,"<?xml version=\"1.0\"?>\r\n<testsuites tests=\"%d\" failures=\"%d\" name=\"CaVa tests\">\r\n  <testsuite name=\"%s\" tests=\"%d\" failures=\"%d\">\r\n",
            testsCasesAllCount, 
            testsCasesFailCount, 
            testName, 
            testsCasesAllCount, 
            testsCasesFailCount);

    for (ii = 0; ii < testsCasesAllCount; ii++)
    {
        strcat(report, report_temp_pass_fail[ii]);
    }
    strcat(report, closer);

    return report;
}

